<?xml version="1.0" encoding="utf-8" ?>
<Defs>

  <ThingCategoryDef>
    <defName>OWD_SoulShards</defName>
    <label>Soul Shards</label>
    <parent>Items_Necromancy</parent>
  </ThingCategoryDef>

  <ThingCategoryDef>
    <defName>OWD_SoulShards_Empty</defName>
    <label>Empty Soul Shards</label>
    <parent>OWD_SoulShards</parent>
  </ThingCategoryDef>

  <ThingCategoryDef>
    <defName>OWD_SoulShards_Filled</defName>
    <label>Filled Soul Shards</label>
    <parent>OWD_SoulShards</parent>
  </ThingCategoryDef>

  <ThingCategoryDef>
    <defName>OWD_SoulShards_Filled_Minor</defName>
    <label>Minor Soul Shards</label>
    <parent>OWD_SoulShards_Filled</parent>
  </ThingCategoryDef>

  <ThingCategoryDef>
    <defName>OWD_SoulShards_Filled_Major</defName>
    <label>Major Soul Shards</label>
    <parent>OWD_SoulShards_Filled</parent>
  </ThingCategoryDef>

  <ThingDef>
    <defName>OWD_SoulShardEmpty</defName>
    <label>Soul Shard (Empty)</label>
    <description>A shard of obsidian-like crystal, strangely cold to the touch. It seems to hum with a faint, empty resonance, as if waiting to be filled.</description>
    <techLevel>Neolithic</techLevel>
    <thingClass>ThingWithComps</thingClass>
    <category>Item</category>
    <resourceReadoutPriority>Middle</resourceReadoutPriority>
    <useHitPoints>true</useHitPoints>
    <selectable>true</selectable>
    <drawGUIOverlay>true</drawGUIOverlay>
    <altitudeLayer>Item</altitudeLayer>
    <stackLimit>25</stackLimit>
    <statBases>
      <MaxHitPoints>100</MaxHitPoints>
      <MarketValue>150</MarketValue>
      <Mass>0.2</Mass>
      <Flammability>0</Flammability>
      <DeteriorationRate>0</DeteriorationRate>
    </statBases>
    <graphicData>
      <texPath>Things/Items/SoulShardEmpty</texPath>
      <graphicClass>Graphic_StackCount</graphicClass>
    </graphicData>
    <comps>
      <li Class="CompProperties_Forbiddable"/>
    </comps>
    <alwaysHaulable>true</alwaysHaulable>
    <tradeability>None</tradeability>
    <thingCategories>
      <li>OWD_SoulShards_Empty</li>
    </thingCategories>
  </ThingDef>

  <ThingDef Name="OWD_SoulShardFilled_Base" Abstract="True">
    <description>A shard of obsidian-like crystal that glows with a faint light. It feels warm to the touch. It is filled with fragments of memory from another Pawn.</description>
    <techLevel>Neolithic</techLevel>
    <thingClass>OneWithDeath.Thing_SoulShardFilled</thingClass>
    <category>Item</category>
    <resourceReadoutPriority>Middle</resourceReadoutPriority>
    <useHitPoints>true</useHitPoints>
    <selectable>true</selectable>
    <drawGUIOverlay>true</drawGUIOverlay>
    <altitudeLayer>Item</altitudeLayer>
    <stackLimit>25</stackLimit>
    <statBases>
      <MaxHitPoints>100</MaxHitPoints>
      <MarketValue>500</MarketValue>
      <Mass>0.2</Mass>
      <Flammability>0</Flammability>
      <DeteriorationRate>0</DeteriorationRate>
    </statBases>
    <graphicData>
      <texPath>Things/Items/SoulShard</texPath>
      <graphicClass>Graphic_StackCount</graphicClass>
    </graphicData>
    <comps>
      <li Class="CompProperties_Forbiddable"/>
      <li Class="OneWithDeath.CompProperties_SoulShard"/>
      <li Class="CompProperties_Usable">
        <compClass>OneWithDeath.CompUsable_ConsumeSoulShard</compClass>
        <useJob>UseItem</useJob>
        <useLabel>Consume {0_label}</useLabel>
        <useDuration>120</useDuration>
      </li>
      <li Class="OneWithDeath.CompProperties_ConsumeSoulShard"/>
      <li Class="CompProperties_UseEffectDestroySelf"/>
      <li Class="CompProperties_Glower">
        <glowRadius>1</glowRadius>
        <glowColor>(255, 255, 255, 0)</glowColor>
      </li>
    </comps>
    <alwaysHaulable>true</alwaysHaulable>
    <tradeability>None</tradeability>
  </ThingDef>

  <ThingDef ParentName="OWD_SoulShardFilled_Base">
    <defName>OWD_SoulShardFilled_Minor</defName>
    <label>Soul Shard</label>
    <thingCategories>
      <li>OWD_SoulShards_Filled_Minor</li>
    </thingCategories>
  </ThingDef>

  <ThingDef ParentName="OWD_SoulShardFilled_Base">
    <defName>OWD_SoulShardFilled_Major</defName>
    <label>Soul Shard</label>
    <thingCategories>
      <li>OWD_SoulShards_Filled_Major</li>
    </thingCategories>
  </ThingDef>

  <RecipeDef>
    <defName>OWD_CraftSoulShardEmpty</defName>
    <label>craft empty soul shards</label>
    <description>Craft 5 empty Soul Shards, an imperfect vessel capable of storing partial "soul" information, recording memories. It is created by infusing a Necrotic orb with a significant amount of stored energy from a linked Control Servitor, splitting the orb into 5 shards.</description>
   <researchPrerequisite>OWD_SoulShardResearch</researchPrerequisite>
    <jobString>Crafting empty soul shards.</jobString>
    <workAmount>2000</workAmount>
<effectWorking>OWD_Effect_AltarCrafting_General</effectWorking>
    <workerClass>OneWithDeath.RecipeWorker_CraftSoulShardEmpty</workerClass>
    <ingredients>
      <li>
        <filter>
          <thingDefs>
            <li>OWD_NecroticOrb</li>
          </thingDefs>
        </filter>
        <count>1</count>
      </li>
    </ingredients>
    <products>
      <OWD_SoulShardEmpty>5</OWD_SoulShardEmpty>
    </products>
    <recipeUsers>
      <li>OWD_Altar</li>
    </recipeUsers>
    <skillRequirements>
      <Crafting>8</Crafting>
    </skillRequirements>
    <modExtensions>
      <li Class="OneWithDeath.RecipeExtension_EnergyCost">
        <energyCost>100</energyCost>
      </li>
    </modExtensions>
  </RecipeDef>

  <RecipeDef>
    <defName>OWD_CleanseSoulShard</defName>
    <label>cleanse soul shard</label>
    <description>Use necrotic energy to cleanse a filled Soul Shard, rendering it empty and ready for a new inscription.</description>
    <researchPrerequisite>OWD_SoulShardResearch</researchPrerequisite>
    <jobString>Cleansing Soul Shard.</jobString>
    <workAmount>800</workAmount>
    <effectWorking>OWD_Effect_AltarCrafting_General</effectWorking>
    <workerClass>OneWithDeath.RecipeWorker_CleanseSoulShard</workerClass>
    <ingredients>
      <li>
        <filter>
          <customSummary>any filled soul shard</customSummary>
          <thingDefs>
            <li>OWD_SoulShardFilled_Minor</li>
            <li>OWD_SoulShardFilled_Major</li>
          </thingDefs>
        </filter>
        <count>1</count>
      </li>
    </ingredients>
    <products>
      <OWD_SoulShardEmpty>1</OWD_SoulShardEmpty>
    </products>
    <recipeUsers>
      <li>OWD_Altar</li>
    </recipeUsers>
    <skillRequirements>
      <Crafting>4</Crafting>
    </skillRequirements>
    <modExtensions>
      <li Class="OneWithDeath.RecipeExtension_EnergyCost">
        <energyCost>100</energyCost>
      </li>
    </modExtensions>
  </RecipeDef>
 
  <OneWithDeath.PsychicRitualRoleDef_Infused>
    <defName>OWD_Target_Infused</defName>
    <label>Target</label>
    <description>A being with a soul shard already infused within them. The ritual will extract this shard.</description>
    <allowedCount>1</allowedCount>
    <applyPowerOffset>false</applyPowerOffset>
    <removeOnLost>true</removeOnLost>
    <allowedConditions>Humanlike, NonHumanlike, Prisoner, Downed, Sleeping</allowedConditions>
  </OneWithDeath.PsychicRitualRoleDef_Infused>

  <OneWithDeath.PsychicRitualDef_ExtractSoulShard>
    <defName>OWD_ExtractSoulShardRitual</defName>
    <label>Extract Soul Shard</label>
    <description>Perform a ritual to forcibly extract an infused soul shard from a pawn, cleansing it of the stored essence. The process is destructive, and may shatter the shard itself if the ritual is not performed with sufficient focus.</description>
    <researchPrerequisite>OWD_SoulShardResearch</researchPrerequisite>
    <iconPath>UI/Commands/SoulExtraction</iconPath>
    <outcomeDescription>The infused soul shard will be removed from the target pawn. Depending on the ritual's quality, an empty soul shard will be produced, or the shard will shatter into nothing.</outcomeDescription>
    <hoursUntilOutcome>2</hoursUntilOutcome>
    <cooldownHours>24</cooldownHours>
    <invocationCircleRadius>1</invocationCircleRadius>
    <invokerRole>OWD_Invoker</invokerRole>
    <chanterRole>OWD_Chanter</chanterRole>
    <targetRole>OWD_Target_Infused</targetRole>
    <modExtensions>
      <li Class="OneWithDeath.RitualExtension_Necrotic"/>
    </modExtensions>
  </OneWithDeath.PsychicRitualDef_ExtractSoulShard>

</Defs>